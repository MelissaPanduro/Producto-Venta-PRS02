<header class="bg-white shadow-md py-4">
  <div class="w-full px-4">
    <h1 class="text-3xl font-extrabold text-blue-900 dark:text-blue-400 md:text-4xl">
      <span class="bg-gradient-to-r from-sky-400 to-blue-600 bg-clip-text text-transparent">
          ➡︎ Gestion de Productos
      </span>
    </h1>
  </div>
</header>

<div class="container mx-auto my-8 p-4 bg-white shadow-md rounded-lg">
  <h2 class="text-2xl font-bold mb-4">Listado de Productos</h2>

  <!-- Botón para agregar producto -->
  <div class="mb-4">
    <button class="bg-blue-600 text-white px-4 py-2 rounded" (click)="addProduct()">Agregar Producto</button>
  </div>

  <!-- Switcher de Estado -->
  <div class="flex items-center mb-4">
    <span class="mr-2 font-semibold">Mostrar:</span>
    <label class="relative inline-flex items-center cursor-pointer">
      <input 
        type="checkbox" 
        class="sr-only peer" 
        [(ngModel)]="statusActive" 
        (change)="toggleStatus()">
      <div 
        class="w-11 h-6 bg-red-500 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer 
        peer-checked:bg-green-500 
        peer-checked:after:translate-x-5 peer-checked:after:border-white 
        after:content-[''] after:absolute after:top-[2px] after:left-[2px] 
        after:bg-white after:border after:rounded-full after:h-5 after:w-5 
        after:transition-all">
      </div>
      <span class="ml-3 text-sm font-medium text-gray-900">
        {{ statusActive ? 'Activos' : 'Inactivos' }}
      </span>
    </label>
  </div>

  <!-- Tabla en Pantallas Grandes -->
  <div class="hidden md:block overflow-x-auto">
    <table class="w-full border-separate border-spacing-y-2 text-sm md:text-base">
      <thead>
        <tr class="bg-blue-100 text-blue-900 text-center">
          <th class="px-2 py-3 font-semibold">ID</th>
          <th class="px-2 py-3 font-semibold">Tipo</th>
          <th class="px-2 py-3 font-semibold">Descripción</th>
          <th class="px-2 py-3 font-semibold">Peso (kg)</th>
          <th class="px-2 py-3 font-semibold">Cantidad</th>
          <th class="px-2 py-3 font-semibold">Precio/kg</th>
          <th class="px-2 py-3 font-semibold">Stock</th>
          <th class="px-2 py-3 font-semibold">Ingreso</th>
          <!--<th class="px-2 py-3 font-semibold">Vencimiento</th>-->
          <!--<th class="px-2 py-3 font-semibold">Proveedor</th>-->
          <th class="px-2 py-3 font-semibold">Estado</th>
          <th class="px-2 py-3 font-semibold">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of paginatedProducts" class="bg-gray-50 hover:bg-gray-100 text-center border-b">
          <td class="px-2 py-3">{{ product.id }}</td>
          <td class="px-2 py-3">{{ product.type }}</td>
          <td class="px-2 py-3">{{ product.description }}</td>
          <td class="px-2 py-3">{{ product.packageWeight }}</td>
          <td class="px-2 py-3">{{ product.packageQuantity }}</td>
          <td class="px-2 py-3">S/ {{ product.pricePerKg | number:'1.2-2' }}</td>
          <td class="px-2 py-3">{{ product.stock }}</td>
          <td class="px-2 py-3">{{ product.entryDate | date: 'dd/MMM/yyyy' : 'es' }}</td>
          <!--<td class="px-2 py-3">{{ product.expiryDate | date: 'dd/MMM/yyyy' : 'es' }}</td>-->
          <!--<td class="px-2 py-3">{{ getSupplierName(product.supplierId) }}</td>-->
          <td class="px-2 py-3">
            <span class="inline-flex w-5 h-5 rounded-full"
                  [ngClass]="{'bg-green-500': product.status === 'A', 'bg-red-500': product.status === 'I'}">
            </span>
          </td>
          <td class="px-2 py-3 flex justify-center space-x-2 text-lg">
            <button *ngIf="product.status === 'A'" class="text-blue-500 hover:text-blue-700" (click)="openModal(product)">
              <i class="fas fa-edit"></i>
            </button>
            <button *ngIf="product.status === 'A'" class="text-red-500 hover:text-red-700" (click)="softDeleteProduct(product.id)">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button *ngIf="product.status === 'I'" class="text-green-500 hover:text-green-700" (click)="restoreProduct(product.id)">
              <i class="fas fa-undo"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Vista para dispositivos móviles (opcional) -->
  <div class="md:hidden">
    <div *ngFor="let product of paginatedProducts" class="bg-gray-50 p-4 rounded-lg mb-3 shadow-sm">
      <div class="flex justify-between items-center">
        <span class="font-bold">ID: {{ product.id }}</span>
        <span class="inline-flex w-4 h-4 rounded-full"
              [ngClass]="{'bg-green-500': product.status === 'A', 'bg-red-500': product.status === 'I'}">
        </span>
      </div>
      <div class="mt-2"><strong>Tipo:</strong> {{ product.type }}</div>
      <div><strong>Descripción:</strong> {{ product.description }}</div>
      <div><strong>Stock:</strong> {{ product.stock }} unidades</div>
      <div><strong>Precio:</strong> S/ {{ product.pricePerKg | number:'1.2-2' }} por kg</div>
      <!--<div><strong>Proveedor:</strong> {{ getSupplierName(product.supplierId) }}</div>-->
      <div class="mt-3 flex justify-end space-x-3">
        <button *ngIf="product.status === 'A'" class="text-blue-500 hover:text-blue-700" (click)="openModal(product)">
          <i class="fas fa-edit"></i>
        </button>
        <button *ngIf="product.status === 'A'" class="text-red-500 hover:text-red-700" (click)="softDeleteProduct(product.id)">
          <i class="fas fa-trash-alt"></i>
        </button>
        <button *ngIf="product.status === 'I'" class="text-green-500 hover:text-green-700" (click)="restoreProduct(product.id)">
          <i class="fas fa-undo"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Estado de carga -->
  <div *ngIf="isLoading" class="text-center mt-4">
    <p>Cargando productos...</p>
  </div>

  <!-- Mensaje cuando no hay productos -->
  <div *ngIf="!isLoading && filteredProducts.length === 0" class="text-center mt-4 p-4 bg-gray-100 rounded">
    <p>No hay productos {{ statusActive ? 'activos' : 'inactivos' }} para mostrar.</p>
  </div>

  <!-- Paginador -->
  <div *ngIf="filteredProducts.length > 0" class="flex justify-center mt-4 space-x-2">
    <button 
      class="px-3 py-2 bg-gray-300 rounded-md text-sm font-semibold hover:bg-gray-400 disabled:opacity-50"
      [disabled]="currentPage === 1"
      (click)="cambiarPagina(currentPage - 1)">
      Anterior
    </button>

    <button 
      *ngFor="let page of getPages()"
      class="px-3 py-2 rounded-md text-sm font-semibold"
      [ngClass]="{'bg-blue-500 text-white': currentPage === page, 'bg-gray-200 hover:bg-gray-300': currentPage !== page}"
      (click)="cambiarPagina(page)">
      {{ page === -1 || page === -2 ? '...' : page }}
    </button>
      
    <button 
      class="px-3 py-2 bg-gray-300 rounded-md text-sm font-semibold hover:bg-gray-400 disabled:opacity-50"
      [disabled]="currentPage === getPages().length"
      (click)="cambiarPagina(currentPage + 1)">
      Siguiente
    </button>
  </div>
</div>

<!-- Modal para Crear/Editar Producto -->
<div *ngIf="showModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 w-full max-w-2xl mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-blue-900">
        {{ editMode ? 'Editar Producto' : 'Nuevo Producto' }}
      </h3>
      <button class="text-gray-500 hover:text-gray-700" (click)="closeModal()">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <form (ngSubmit)="saveProduct()">
      <!-- Campo oculto para mantener el status -->
      <input type="hidden" [(ngModel)]="currentProduct.status" name="status">
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Tipo -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Tipo:</label>
          <select class="px-3 py-2 rounded border w-full" 
                  [(ngModel)]="currentProduct.type" name="type" required>
            <option value="" disabled selected>Selecciona un tipo</option>
            <option value="huevos">Huevos</option>
            <option value="pollo">Pollo</option>
            <option value="abono">Abono</option>
          </select>
        </div>
        

        <!-- Descripción -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Descripción:</label>
          <input type="text" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.description" name="description" required>
        </div>

        <!-- Peso del Paquete -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Peso del Paquete (kg):</label>
          <input type="number" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.packageWeight" name="packageWeight" min="0" step="0.01" required>
        </div>

        <!-- Cantidad por Paquete -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Cantidad por Paquete:</label>
          <input type="number" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.packageQuantity" name="packageQuantity" min="1" required>
        </div>

        <!-- Precio por Kg -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Precio por Kg (S/):</label>
          <input type="number" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.pricePerKg" name="pricePerKg" min="0" step="0.01" required>
        </div>

        <!-- Stock -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Stock:</label>
          <input type="number" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.stock" name="stock" min="0" required>
        </div>

        <!-- Fecha de Ingreso -->
        <div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Ingreso:</label>
          <input type="date" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.entryDate" name="entryDate" required>
        </div>

        <!-- Fecha de Vencimiento -->
        <!--<div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Vencimiento:</label>
          <input type="date" class="px-3 py-2 rounded border w-full" 
                 [(ngModel)]="currentProduct.expiryDate" name="expiryDate" required>
        </div>-->

        <!-- Proveedor -->
         <!--<div class="mb-3">
          <label class="block text-sm font-medium text-gray-700 mb-1">Proveedor:</label>
          <select class="px-3 py-2 rounded border w-full" 
                  [(ngModel)]="currentProduct.supplierId" name="supplierId" required>
            <option [ngValue]="null" disabled>Seleccione un proveedor</option>
            <option *ngFor="let supplier of suppliers" [value]="supplier.id">
              {{ supplier.company }}
            </option>
          </select>
        </div>-->
      </div>

      <div class="flex justify-end space-x-3 mt-6">
        <button type="button" class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400" 
                (click)="closeModal()">
          Cancelar
        </button>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
          {{ editMode ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>
    </form>
  </div>